plugins {
    id 'java'
    id 'de.aaschmid.cpd' version '3.1'
}

apply plugin: 'java'
apply plugin: 'de.aaschmid.cpd'

repositories {
    mavenCentral()
}

// Failure if defined before integrationTest source set
cpdCheck {
    source = files('src/main/java')
}
sourceSets {
    integrationTest {
    }
}
// OK if defined after integrationTest source set
//cpdCheck {
//    source = files('src/main/java')
//}

task integrationTest(type: Test) {
    description = 'Runs integration tests.'
    group = 'verification'

    testClassesDirs = sourceSets.integrationTest.output.classesDirs
    classpath = sourceSets.integrationTest.runtimeClasspath
    shouldRunAfter test
}

check.dependsOn integrationTest
check.dependsOn cpdCheck